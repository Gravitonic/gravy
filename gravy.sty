\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{gravy}

\newif\if@gravy@nodate\@gravy@nodatefalse
\DeclareOption{nodate}{
  \@gravy@nodatetrue
}

\ProcessOptions*

% koma-script inserts the date using {\usekomafont{date}{\@date \par}} followed by a 1em \vskip
% subtract:
% - 1em for the height of the date itself
% - 1em for the space added afterwards
% - one \parskip for the space added by \par
\if@gravy@nodate
\date{~\vspace{-2em \@minus \parskip}}
\fi

% font setup
\RequirePackage[T1]{fontenc}

\RequirePackage{libertine}
\RequirePackage[libertine]{newtxmath}
\RequirePackage[scaled=0.83]{FiraMono}

% page setup
\KOMAoptions{
  paper=letter,
  usegeometry,
}

\RequirePackage{geometry}
\geometry{
  paper=letterpaper,
  hmargin=132pt,
  top=84pt,
  bottom=156pt
}

% improve ligature copy-pasting
% see: https://tex.stackexchange.com/a/64191
\pdfgentounicode=1
\input{glyphtounicode}

% list formatting
\RequirePackage[shortlabels]{enumitem}
\setlist[itemize,enumerate,1]{leftmargin=0pt}
\setlist[itemize,3]{label=\textopenbullet}
\setlist{listparindent=\parindent,noitemsep}

\AtBeginDocument{
  \ifdim\parskip=0pt
    \setlist*{topsep=0.5em}
  \fi
}

% typography
\RequirePackage{microtype}

% footer
\RequirePackage{scrlayer-scrpage}
\pagestyle{scrheadings}

\setkomafont{pagefoot}{\normalfont\sffamily}

\ihead[]{}
\chead[]{}
\ohead[]{}
\if@chapter
  \automark[section]{chapter}
  \ifoot[]{\headmark}
\else
  \ifoot[]{\@title}
\fi
\cfoot[]{}
\ofoot[\pagemark]{\pagemark}

% math
\RequirePackage{mathtools}
\RequirePackage{esint}

% hyperlinks
\RequirePackage{hyperref}
\hypersetup{
  linktoc=all,
  colorlinks=true,
}

\RequirePackage{gravycommands}
